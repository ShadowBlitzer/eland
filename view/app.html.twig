{% extends 'base.html.twig' %}

{% import 'macro/flash.html.twig' as f %}
{% import 'macro/menu.html.twig' as m %}

{% set route_params = global.request.attributes.get('_route_params') %}
{% set query_params = global.request.query.all %}
{% set all_params = route_params|merge(query_params) %}
{% set route = global.request.attributes.get('_route') %}
{% set route_ary = route|split('_') %}
{% set active_menu = route_ary[1] is defined and route_ary[1] == 'self' ? route : route_ary[0] %}
{% set schema = global.request.attributes.get('schema') %}
{# {% set access = global.request.attributes.get('access') %} #}
{% if access is defined %}
	{% set acc_sch = {'schema': schema, 'access': access} %}
{% endif %}

{% set menu_el =
	menu_ary[active_menu] ??
	personal_menu_ary[active_menu] ??
	admin_menu_ary[active_menu] ??
	'undefined'
%}

{%- block title -%}{{- config('systemname', schema) -}}{%- endblock title -%}

{%- block url_index -%}{%- endblock url_index -%}

{%- block content -%}

	<div class="row-offcanvas row-offcanvas-left">
	<div id="sidebar" class="sidebar-offcanvas">

	{# <div id="menu"> #}

	<br>
	<ul class="nav nav-pills nav-stacked">

	{%- block menu_left -%}{%- endblock -%}

	</ul>
	</div>

	<div id="wrap">
	{# <div id="panel"> #}
	<div id="main" class="container-fluid clear-top{%- block div_main_class -%}{%- endblock -%}">

	{%- block flash -%}{{- f.flash() -}}{%- endblock flash -%}

	<div class="row">
	<div class="col-md-12 top-buttons">
	<div class="visible-xs pull-left button-offcanvas">
	<button type="button" class="btn btn-default btn-md " data-toggle="offcanvas" title="{{- 'label.menu'|trans -}}">
	<i class="fa fa-bars"></i>
	</button>&nbsp;</div>

	{%- block top_buttons -%}{%- endblock -%}
	{%- block top_buttons_right -%}{%- endblock -%}
	</div>
	</div>

	{%- block top_right_container -%}
		<div class="pull-right">
		{%- block top_right -%}{%- endblock -%}
		</div>
	{%- endblock top_right_container -%}

	{%- block heading_container -%}
		<h1>
		{%- block heading_pre -%}{%- endblock -%}
		{%- block heading_fa_container -%}
		<i class="fa fa-{%- block fa -%}{{- menu_el['fa'] -}}{%- endblock -%}">
		</i> {% endblock heading_fa_container -%}
		{%- block heading -%}
			{{- menu_el['title']|trans -}}
		{%- endblock heading -%}
		{%- if filtered is defined and filtered %} <span class="small">{{- 'tag.filtered'|trans -}}
			</span>{%- endif -%}
		{%- block heading_post -%}{%- endblock -%}
		{%- block heading_right -%}{%- endblock -%}
		</h1>
	{%- endblock heading_container -%}

	{%- block pre_inner -%}{%- endblock -%}
	{%- block inner -%}{%- endblock -%}
	{%- block post_inner -%}{%- endblock -%}

	</div>
{%- endblock content -%}

{%- block footer_extra -%}
	<p>{{- 'eland.github'|trans({
		'%link_issues_open%': '<a href="https://github.com/eeemarv/eland/issues">',
		'%link_github_open%': '<a href="https://github.com">',
		'%link_close%': '</a>'
	})|raw -}}</p>
{%- endblock footer_extra -%}
